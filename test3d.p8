pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include ins.p8
function _init()
	--player
	--fov is 90 degrees in revolutions
	p={x=14,y=136,a=0,spd=0.7,fov=0.25,cosa=cos(0.01),sina=sin(0.01),sens=0.015,hp=100,timewhenshoot=0,level=1,weapon=nil,shooting=false}

	mm={h=32,w=32}

	-- last player position
	lastppos={x=0,y=0}

	sprites={
		enemies={
			-- skeleton
			{sx=48,sy=0,w=16,h=16,ws=2,hs=2,x=20,y=44,spd=0.25,path={},goal={},lastpos={},step=1,state="patrol",route={{20,44},{44,44}},timewhenlos=0,timewhenshoot=0,hp=50,vmove=0},
		}
	}

	levels = {
		{
			sprites={
				enemies={
					{sx=48,sy=0,w=16,h=16,ws=2,hs=2,x=48,y=170,spd=0.25,state="passive",hp=50,vmove=0},
				},
				pickups={
					{type="gun",guntype="pistol",sx=112,sy=2,w=16,h=12,ws=2,hs=1,x=50,y=136,vmove=-150}
				},
				text={
					-- move esdf
					{sx=8,sy=16,w=17,h=7,ws=8,hs=3,x=26,y=135.5,vmove=200},
					{sx=25,sy=16,w=16,h=8,ws=8,hs=3,x=26,y=135,vmove=-200},

					-- turn arrows
					{sx=41,sy=16,w=17,h=7,ws=8,hs=3,x=40,y=135.5,vmove=200},
					{sx=58,sy=16,w=15,h=8,ws=8,hs=3,x=40,y=135.5,vmove=-200},

					-- shoot x
					{sx=73,sy=16,w=21,h=7,ws=8,hs=3,x=48,y=156,vmove=200},
					{sx=94,sy=16,w=7,h=7,ws=3,hs=3,x=48,y=156,vmove=-200},
				}
			}
		}
	}

	weapons={
		pistol={
			sprite=8,
			damage=10,
			range=70,
			fire_rate=0.4,
			accuracy=0.5
		},
		shotgun={
			sprite=10,
			damage=20,
			range=30,
			fire_rate=1,
			accuracy=0.4
		}
	}

	lines={}

	poke(0x5f38, 1)
	poke(0x5f39, 1)
	-- poke(0x5f3a, 48)

	printh("\n##### init #####\n")

	texw = 8.0
	texh = 8.0
end

function _update()
	input_update()
	enemy_sprite_update()
	pickup_update()

	for _, sprtype in pairs(levels[p.level].sprites) do
		for sprite in all(sprtype) do
			sprite.dist = dist(p.x, p.y, sprite.x, sprite.y)
		end
	end

	-- sort sprites by distance via insertion sort
	for _, sprtype in pairs(levels[p.level].sprites) do
		for i=1, #sprtype do
			local key = sprtype[i]
			local j = i-1
			while j >= 1 and key.dist > sprtype[j].dist do
				sprtype[j+1] = sprtype[j]
				j = j - 1
			end
			sprtype[j+1] = key
		end
	end
end

function _draw()
	cls()

	--floor
	rectfill(0,64,127,127,6)

	--ceiling
	rectfill(0,0,127,63,12)

	pal()

	palt(0, false)
	for i=0, 127 do
		local ang = p.a + (i - 64) * (p.fov / 128)
		local ray = shoot_ray(p.x, p.y, ang)
		lines[i + 1] = ray.dist
		local wallh = 128 / ray.dist
		local topy = flr(64 - wallh / 2 * 6)
		local boty = flr(64 + wallh / 2)
		local sx = ray.s * 8 + ray.tex % 8 * 2

		local u = flr(ray.tex * texw)
		u = texw - u - 1

		-- local wallh = boty - topy
		local pstep = (1.0*texh) / wallh

		printh("u: "..u)

		tline(i, topy, i, boty, u / 8, 0, 0, pstep/32)
		-- for y=topy, boty do
		-- 	local rely = (y - topy) / wallh
		-- 	local sy = flr(rely * 16)
		-- 	local col = sget(sx, sy)
		-- 	pset(i, y, col)
		-- end
	end

	palt(8, true)
	pal(14, 132, 1)

	for _,sprtype in pairs(levels[p.level].sprites) do
		for sprite in all(sprtype) do
			draw_sprite(sprite)
		end
	end

	--draw player weapon
	if p.shooting then
		palt(8, false)
		palt(0, true)
		sspr(8, 8, 8, 8, 56, 90, 16, 16)
	end

	if p.weapon then
		palt(8, true)
		palt(0, false)
		sspr(weapons[p.weapon].sprite*8,0,16,16,47,96,32,32)
	end


	print("cpu: "..stat(1).." ".."mem: "..stat(0),7)
	print("fps: "..stat(7),7)
	print(peek(0x5f80))
end

function shoot_ray(x,y,a)
	local dx = cos(a)
	local dy = sin(a)

	local mapx = flr(x / 8)
	local mapy = flr(y / 8)

	local tilex = x / 8
	local tiley = y / 8

	local deltadistx = abs(1 / dx)
	local deltadisty = abs(1 / dy)

	local sidedistx, sidedisty, stepx, stepy, side

	if dx < 0 then
		stepx = -1
		sidedistx = (tilex - mapx) * deltadistx
	else
		stepx = 1
		sidedistx = (mapx + 1 - tilex) * deltadistx
	end
	if dy < 0 then
		stepy = -1
		sidedisty = (tiley - mapy) * deltadisty
	else
		stepy = 1
		sidedisty = (mapy + 1 - tiley) * deltadisty
	end

	local s = 1
	local hit = false

	while not hit do
		if sidedistx < sidedisty then
			sidedistx += deltadistx
			mapx += stepx
			side = 0
		else
			sidedisty += deltadisty
			mapy += stepy
			side = 1
		end

		s=mget(flr(mapx), flr(mapy))
		if s~=0 then
			hit = true
		end
	end

	local perpwalldist

	if side == 0 then
		perpwalldist = (sidedistx - deltadistx) * 8
		wallx = y + perpwalldist * dy
	else
		perpwalldist = (sidedisty - deltadisty) * 8
		wallx = x + perpwalldist * dx
	end

	wallx -= flr(wallx)

	return {dist=perpwalldist, tex=wallx, s=s}
end

function spriteshoot(sprite)
	local dist = dist(sprite.x, sprite.y, p.x, p.y)
	if rnd(dist)<weapons[p.weapon].accuracy * 6 then -- simulate accuracy
		-- deal damage to player
		p.hp -= 5
		sprite.timewhenshoot = time()
	end
end

function playershoot()
	local x = p.x
	local y = p.y
	local max_dist = weapons[p.weapon].range
	local dx = p.cosa
	local dy = p.sina
	p.shooting = true

	for i = 1, max_dist do
		x += dx
		y += dy
		if mget(flr(x / 8), flr(y / 8)) ~= 0 then
			break
		end
		local enemy = is_enemy_hit(x, y)
		if enemy then
			printh("hit enemy")
			if enemy.hp <= 0 then
				-- remove enemy from level
				del(levels[p.level].sprites.enemies, enemy)
				printh("enemy dead")
			end
			break
		end
	end
end

function is_enemy_hit(x, y)
	for enemy in all(levels[p.level].sprites.enemies) do
		if abs(x - enemy.x) < 4 and abs(y - enemy.y) < 4 then
			enemy.hp -= 10
			printh("HIT: "..enemy.hp)
			return enemy
		end
	end
	return nil
end

-- check if there is a line of sight between two points
function has_los(x1, y1, x2, y2)
	local dx = x2 - x1
	local dy = y2 - y1

	local dist = sqrt(dx * dx + dy * dy)

	local step_x = dx / dist
	local step_y = dy / dist

	local x = x1
	local y = y1

	for i=0, dist do
		x += step_x
		y += step_y
		if mget(flr(x / 8), flr(y / 8)) ~= 0 then
			return false
		end
	end

	return true
end

function draw_sprite(sprite)
	local posx = sprite.x - p.x
	local posy = sprite.y - p.y

	local tx = p.cosa * posy - p.sina * posx
	local ty = -p.sina * posy - p.cosa * posx


	local screenx = (128 / 2) * (1 + tx / ty)

	local sprh = abs(128 / ty) * sprite.hs
	local sprw = abs(128 / ty) * sprite.ws

	local draw_start_y=-sprh / 2 + 128/2 + sprite.vmove / ty
	local draw_start_x=-sprw / 2 + screenx

	if draw_start_x <= 127 and draw_start_x >= 0 then
		if lines[flr(draw_start_x) + 1] > abs(ty) and ty < 0 then
			sspr(sprite.sx, sprite.sy, sprite.w, sprite.h, draw_start_x, draw_start_y, sprw, sprh)
		end
	end
end

function input_update()
	if btn(0,0) then
		p.a = (p.a - p.sens) % 1
	end
	if btn(1,0) then
		p.a = (p.a + p.sens) % 1 
	end
	p.cosa = cos(p.a)
	p.sina = sin(p.a)

	if btn(2, 1) then
		local nx = p.x + p.cosa * p.spd
		local ny=p.y + p.sina * p.spd
		if mget(flr(nx / 8), flr(ny / 8)) == 0 then
			p.x = nx
			p.y = ny
		end
	end
	if btn(3, 1) then
		local nx = p.x - p.cosa * p.spd
		local ny = p.y - p.sina * p.spd
		if mget(flr(nx / 8), flr(ny / 8)) == 0 then
			p.x = nx
			p.y = ny
		end
	end
	if btn(1, 1) then
		local strafe_ang = p.a + 0.25
		local nx = p.x + cos(strafe_ang) * p.spd
		local ny=p.y + sin(strafe_ang) * p.spd
		if mget(flr(nx / 8), flr(ny / 8)) == 0 then
			p.x = nx
			p.y = ny
		end
	end
	if btn(0, 1) then
		local strafe_ang = p.a - 0.25
		local nx = p.x + cos(strafe_ang) * p.spd
		local ny = p.y + sin(strafe_ang) * p.spd
		if mget(flr(nx / 8), flr(ny / 8)) == 0 then
			p.x = nx
			p.y = ny
		end
	end

	if p.timewhenshoot + 0.1 < time() then
		p.shooting = false
	end

	if btn(4) and p.weapon and p.timewhenshoot + weapons[p.weapon].fire_rate < time() then
		p.timewhenshoot = time()
		playershoot()
		printh("shoot"..time())
	end
end

function pickup_update()
	for sprite in all(levels[p.level].sprites.pickups) do
		if abs(sprite.x - p.x) < 4 and abs(sprite.y - p.y) < 4 then
			if sprite.type == "gun" then
				p.weapon = sprite.guntype
				printh("picked up "..sprite.guntype)
			end
			del(levels[p.level].sprites.pickups, sprite)
		end
	end
end

function enemy_sprite_update()
	for sprite in all(sprites.enemies) do
		if sprite.state == "chase" then
			if lastppos[1] ~= flr(p.x / 8) or lastppos[2] ~= flr(p.y / 8) then
				local path=astar({sprite.x, sprite.y}, {p.x, p.y})
				if sprite.path then
					sprite.path = path
					sprite.step = 1
					printh("path "..ins(sprite.path).." "..time())
				end
				lastppos={flr(p.x / 8), flr(p.y / 8)}
			end

			sprite.goal = sprite.path[#sprite.path - sprite.step]
			if sprite.step < #sprite.path then
				mvspr2goal(sprite)
			end
			
			-- shoot gun if dist is less than 20 and player is in sight
			local dist = dist(sprite.x, sprite.y, p.x, p.y)

			if has_los(sprite.x, sprite.y, p.x, p.y) then
				-- reset timer
				sprite.timewhenlos = time()
				if dist < 20 and rnd(1) < 0.5 then
					-- shoot gun if dist is less
					spriteshoot(sprite)
				end
				if dist < 10 then
					sprite.state = "shoot"
				end
			end

			if sprite.timewhenlos + 5 <= time() then
				-- go back to patrol after 10 seconds
				sprite.state = "backtopatrol"
			end
		end

		if sprite.state == "backtopatrol" then
			sprite.path = astar({sprite.x, sprite.y}, {sprite.route[1][1], sprite.route[1][2]})
			sprite.step = 1
			sprite.goal = sprite.path[#sprite.path - sprite.step]
			if sprite.step < #sprite.path then
				mvspr2goal(sprite)
			else
				-- we can assume we are at the start of the route
				sprite.state = "patrol"
				sprite.step = 1
			end
		end

		if sprite.state == "shoot" then
			-- shoot player if dist is less than 6 and player is in sight
			local dist = dist(sprite.x, sprite.y, p.x, p.y)
			if dist < 10 and has_los(sprite.x, sprite.y, p.x, p.y) then
				if sprite.timewhenshoot + 1 <= time() then
					spriteshoot(sprite)
				end
			else
				sprite.state = "chase"
			end
		end

		if sprite.state == "patrol" then
			if sprite.step > #sprite.route then
				-- finished with route, restart
				sprite.step = 1
			end
			sprite.goal = sprite.route[sprite.step]
			mvspr2goal(sprite)
		end

		if has_los(sprite.x, sprite.y, p.x, p.y) and sprite.state ~= "shoot" then
			-- begin chase if player is in sight
			sprite.state = "chase"
			sprite.timewhenlos = time()
		end
	end
end

-- slowly move sprite (e.g enemy) towards their goal (e.g player)
function mvspr2goal(sprite)
	local dx = sprite.goal[1] - sprite.x
	local dy = sprite.goal[2] - sprite.y
	local dist=sqrt(dx*dx+dy*dy)

	if dist <= sprite.spd then
		sprite.step += 1
		sprite.x = sprite.goal[1]
		sprite.y = sprite.goal[2]
	else
		sprite.x += dx / dist * sprite.spd
		sprite.y += dy / dist * sprite.spd
	end
end

--a* pathfinding algorithm
--starting point as {x,y}, end point as {x,y}
function astar(spnt,epnt)
	spnt = {flr(spnt[1] / 8), flr(spnt[2] / 8)}
	epnt = {flr(epnt[1] / 8), flr(epnt[2] / 8)}

	local open = {[pntkey(spnt)] = spnt}
	local camefrom={}

	local gscore = {[pntkey(spnt)] = 0}
	local fscore = {[pntkey(spnt)] = dist(spnt[1], spnt[2], epnt[1], epnt[2])}

	while next(open) do
		local currentkey, current=minf(open, fscore)
		if current[1] == epnt[1] and current[2] == epnt[2] then
			--found the path, now construct it and return it
			local path = {}
			while current do
				add(path, {current[1] * 8 + 4, current[2] * 8 + 4})
				current = camefrom[pntkey(current)]
			end
			return path
		end

		open[currentkey]=nil
		for n in all(neighbors(current)) do
			local nkey = pntkey(n)
			g = gscore[currentkey] + dist(current[1], current[2], n[1], n[2])
			if g < (gscore[nkey] or 32767) then
				gscore[nkey] = g
				fscore[nkey] = g + dist(n[1], n[2], epnt[1], epnt[2])
				camefrom[nkey] = current
				if not open[nkey] then
					open[nkey] = n
				end
			end
		end
	end

	printh("ahhhhh")
	return nil
end

function pntkey(p)
	return p[1]..','..p[2]
end

function minf(open, fscore)
	local minkey, minpnt = nil, nil
	local min = 32767
	for k, v in pairs(open) do
		local f = fscore[k] or 32767
		if f < min then
			min = f
			minkey = k
			minpnt = v
		end
	end
	return minkey, minpnt
end

function neighbors(node)
	local dirs = {{1, 0}, {1, 1}, {0, 1}, {-1, 1}, {-1, 0}, {-1, -1}, {0, -1}, {1, -1}}
	local n = {}
	for p in all(dirs) do
		local nx = node[1] + p[1]
		local ny = node[2] + p[2]
		if mget(nx, ny) == 0 then
			add(n, {nx, ny})
		end
	end
	return n
end

function dist(x1,y1,x2,y2)
	return sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2))
end

--function dist2col(dist)
	--the higher bits are the so-called "transition" colors
	--cols={0x77,0x76,0x66,0x6d,0xdd,0xd5,0x55,0x51,0x11,0x12,0x22,0x20,0x00}
	--dist=mid(1,dist,40)
	--local index=flr(#cols*(dist/40))+1
	--return cols[index] or cols[#cols]
--end

-- function draw_minimap()
-- 	clip(0,0,mm.w,mm.h)
-- 	palt(0,false)
--
-- 	local sx=flr(mid(-32,(mm.w/2)-p.x,0))
-- 	local sy=flr(mid(-56,(mm.h/2)-p.y,0))
-- 	map(0,0,sx,sy)
--
-- 	--draw player and direction line
-- 	local px=flr(p.x+sx)
-- 	local py=flr(p.y+sy)
--
-- 	local rx=flr(dir_ray.x+sx)
-- 	local ry=flr(dir_ray.y+sy)
--
-- 	line(px,py,rx,ry,8)
-- 	pset(px,py,8)
-- 	clip()
-- 	palt()
-- end
__gfx__
0000000077777777aaa99990aaa99990777777777777777788888000000888888888888008888888888800088000888888888888888888888888888888888888
0000000077777777a4444440a44444407dddddddddddddd788880777777088888888880660888888888067600676088888888888888888888888888888888888
007007007777777794444440944444407dddddddddddddd788880765765088888888805665088888888067655676088888888888888888888808888888888808
000770007777777700000000000000007dd5555555555dd788880777700088888888800000088888888067655676088888888888888888888050000000000070
0007700077777777990aaa99990aaa997dd5000000007dd788880777044088888888070670508888888067655676088888888888888888880666566666667770
0070070077777777440a4444440a44447dd5055555507dd788888000604408888888050550508888888067655676088888000000000000080665555555555550
000000007777777744094444440944447dd5056666707dd788880007600408888888050000508888888067655676088880064566666666600555555555555550
000000007777777700000000000000007dd5056666707dd788807777677440888888055555500888888067655676088804484444400000088005450850000008
0000000080089900aaa99990aaa999907dd5056666707dd788806669666440888888066666609088888067655676088804444700008888888805458850888888
0000000089989aa8a4444440a44444407dd5056666707dd788077777677400888880007777609088888067655676088880400008888888888054555550888888
000000000889888094444440944444407dd5057777707dd788800007600408888809900000099088888067655676088880008888888888888054500008888888
000000008a9aa8aa00000000000000007dd5000000007dd788888077680408888809999999999088888055011055088888888888888888880545088888888888
00000000088aaa90990aaa99990aaa997dd5777777777dd788880777604408888809faffffff9088888801111110888888888888888888880555088888888888
000000000088a888440a4444440a44447dddddddddddddd788807700604088888809faffffff9088888804411440888888888888888888888000888888888888
00000000089a888044094444440944447dddddddddddddd788077088044088888809faaffff99088888880444408888888888888888888888888888888888888
00000000008a000000000000000000007777777777777777888008880008888888099faafff99088888880444408888888888888888888888888888888888888
00000000000000000000000000008800800088000000000000000000008888888888888880000000000000000000000888880888888889999998888800000000
0000000007770077070707770088808880880808807770707077707700877777888777778007707070077007707770808880888888889e0440e9888800000000
000000000777070707070700008880888088080880070070707070707077788778778877707000707070707070070088080888888889ee0440ee988800000000
0000000007070707070707700008800080880800000700707077007070778887787788877077707770707070700700888088888888809e0440e9088800000000
00000000070707070777070000888880808808088007007070707070707778877877887770007070707070707007008808088888880ee999999ee08800000000
00000000070707700070077700888880808808088007000770707070708777778887777780770070707700770007008088808888880ee044440ee08800000000
000000000000000000000000008888808088080880000000000000000088888888888888800000000000000000000008888808888806e044440e608800000000
00000000888888888888888880008008800008088888888888888888888888888888888888888888888888888888888888888888880667744776608800000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000880eed6776dee08800000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000880ee044440ee08800000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000880ee044440ee08800000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000880ee044440ee08800000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000880667744776608800000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008880ed6776de088800000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008880ee0440ee088800000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000888800000000888800000000
__label__
a77977707a799990aaa97790aaa977707c7c777c77cccccc777c777c777ccccccccc777c7ccccccc777c777c77cc777ccccccccccccccccccccccccccccccccc
7444747074744740a4444740a44474707c7c7cccc7cccccc777c7ccc777cc7cccccccc7c7ccccccccc7c7c7cc7cc7c7ccccccccccccccccccccccccccccccccc
74447770747444409444474094447470777c777cc7cccccc7c7c77cc7c7cccccccccc77c777cccccc77c777cc7cc777ccccccccccccccccccccccccccccccccc
70007000707007000000070000007070cc7ccc7cc7cccccc7c7c7ccc7c7cc7cccccccc7c7c7ccccccc7c7c7cc7cc7c7ccccccccccccccccccccccccccccccccc
977a7a99977aaa99990a7779970a7779cc7c777c777ccccc7c7c777c7c7ccccccccc777c777cc7cc777c777c777c777ccccccccccccccccccccccccccccccccc
440a4444440a4444440a4444440a4444cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
77797774477944444409774477794444cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
70007070700007000000070070000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
77a97770777000000000070077777777cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
7444744000700700000007007d7dddddcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
744474407770070000707770777dddddcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
0000000000077000000770007dd55555cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
990aaa9900077000000770007dd50000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
440a444400700700007007007dd50555cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
4409444408000000000000007dd50566cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
0000000000800000000000007dd50566cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaa99990008000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
a4444440000800000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
94444440007087000070070000700700cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
00000000000778000007700000077000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
990aaa99000778000007700000077000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
440a4444007007800070070000700700cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44094444000000080000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
00000000000000080000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaa99990000000008000000077777777cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
a444444000000000080000007dddddddcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
9444444000700700008007007dddddddcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
0000000000077000008770007dd55555cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
990aaa9900077000000870007dd50000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
440a444400700700007087007dd50555cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
4409444400000000000080007dd50566cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
0000000000000000000008007dd50566cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
000044444aaacccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaaa44444aaaaacccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaaa44444aaaaacccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaaa00000999aacccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaaa00000999449ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44449999999944999ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44449999900044499ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44449999900044444ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44444444499900444acccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44444444499900444a9ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
4444444449990004449acccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
0000444444440000044acccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc777777777777
00004444444400a0044a9ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc7777cccccccccccccccccccccccccccc777777777777
00004444444400a9904999ccccccccccccccccccccccccccccccccccccccccccccccccccc777777777777777777777cccccccccccccccccccccc77dddddddddd
99990000044400499009499cccccccccccccccccccccccccccccccccccccccccccccc777777777777777dd777777777777cccccccccccccccccc77dddddddddd
99990000000000444000449cccccccccccccccc777777777777777777cccccccccccc7777ddddddddddddd77dddddd777777777ccccccccccccc77dddddddddd
999999999000004440a9444acccccccccccccc7777777777777777777cccccccccccc77ddddddddddddddd77dddddddd77777777cccccccccccc77dddd555555
99999999900000444049004a9ccccccccccccc7dddd7ddddddddddddd77777777cccc77dd55555555555dd77555555dd77ddddd7a099aa099aa077dddd770000
444499999aaa00044044aa044a99aa9aaa90a9ddddd7ddddddddddddd7ddddddda9a977d500000005555dd775500005577ddddd740444a04444077dddd770000
444444444aaaaa0000444a944444a44aa44044d55dd7d5555555555dd7ddddddd444477d700000000055dd775500000777d5555740444904444077dddd770055
444444444aaaaa999044444004449449944044d00dd7d5000000007dd755555dd444477d705555550055dd775555550777d0000700000000000077dddd770077
444444444aaa449990004440a0000000000000d55dd7d5555555007dd700007dd000077d707766660055dd775555665777d5550799aa099aa09977dddd770077
444444444aaa44444a9a004049a990a990a99ad65dd7d5566666007dd705557dd9a9a77d707766660055dd775555667777d5660744440444404477dddd770077
4444444449994444449a99004444404440444ad65dd7d5566666007dd705667dd444477d707766660055dd775555667777d5660744440444404477dddd770077
0000444449994444444a999004444044404449d65dd7d5566666007dd705667dd444477d707766660055dd775555667777d5660700000000000077dddd770077
00000000000000444449444a90000000000000d65dd7d5566666007dd705667dd000077d707766660055dd775555667777d56607a099aa099aa077dddd770077
0000000000000000044944444a99aa9aaa90a9d75dd7d5566666007dd705667dd444477d707777770055dd775555777777d5670740444a04444077dddd770077
aaaa999999990000000040044444a44aa44044d05dd7d5577777007dd705777dd444477d700000000055dd775500007777d5770740444904444077dddd770000
aaaa9999999900a990a90a90a0000000000000d70dd7d5000000007dd700007dd000077d777777770055dd775577770777d0007700000000000077dddd777777
aaaa9999999900a990a9aa4049a990a990a99add7dd7d5777777777dd777777dd9a9a77d7ddd77777755dd775577dd7777d7777799aa099aa09977dddd777777
aaaa444444440044404444404444404440444addddd7ddddddddddddd7ddddddd444477ddddddddddddddd77dddddddd77ddddd744440444404477dddddddddd
44444444444400444044444004444044404449ddddd7ddddddddddddd7ddddddd444477ddddddddddddddd77dddddddd77ddddd744440444404477dddddddddd
44444444444400444040400060000000000000777777777777777777777777777000077dd7777777dddd7777dd7777d777d7777700000000000077dddddddddd
44444444444400400000066666666666666666666666666666666666666666666666666776666666777766667766667666766660666666666666777777777777
44444444444400000006066666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
44444444400000066666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
44440000000066066666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
00000000066666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
00006666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
00006666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
00006666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666

__map__
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000002000000000000000000000000000000020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003030003030000
0200000000000000000000000000000200000000000000000000000000000002000000000000000000000000000000020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000303000303
0200000404040400000404040400000200000404040400000404040400000002000000040400000000000404000000020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000000000000000400000002000004040400000400000404040000020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000000000000000400000002000000040400000000000404000000020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000404040400000400000002000000000000000000000000000000020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000400000400000400000400000002000000000000000000000000000000020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000400000400000400000400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000400000400000400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000000000000000400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000000000000000400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000404040404040404040400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000002000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000002000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202000002000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000002000002000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000002000002000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000002000002000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000002040402000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
