pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include ins.p8
function _init()
	--player
	--fov is 110 degrees in revolutions
	p={x=20,y=12,a=0.01,spd=0.7,fov=0.25,cosa=cos(0.01),sina=sin(0.01),sens=0.015,hp=100,timewhenshoot=0,weapon="gun"}

	mm={h=32,w=32}

	-- last player position
	lastppos={x=0,y=0}

	sprites={
		enemies={
			-- barrel, example enemy
			{s=6,w=16,h=16,ws=2,hs=2,x=20,y=44,spd=0.25,path={},goal={},lastpos={},step=1,state="patrol",route={{20,44},{44,44}},timewhenlos=0,timewhenshoot=0,hp=50},
		}
	}

	weapons={
		pistol={
			damage=10,
			range=70,
			fire_rate=0.5,
			accuracy=0.5
		},
		shotgun={
			damage=20,
			range=30,
			fire_rate=1,
			accuracy=0.4
		}
	}

	lines={}

	printh("\n##### init #####\n")
end

function _update()
	input_update()
end

function _draw()
	cls()

	--floor
	rectfill(0,64,127,127,6)

	--ceiling
	rectfill(0,0,127,63,12)

	pal()

	for i=0, 127 do
		local ang = p.a + (i - 64) * (p.fov / 128)
		local ray = shoot_ray(p.x, p.y, ang)
		lines[i + 1] = ray.dist
		local wallh = 128 / max(1, ray.dist)
		local topy = 64 - wallh / 2 * 6
		local boty = 64 + wallh / 2
		local sx = ray.s * 8 + ray.tex % 8 * 2

		local wallh = boty - topy
		for y=topy, boty do
			local rely = (y - topy) / wallh
			local sy = flr(rely * 16)
			local col = sget(sx, sy)
			pset(i, y, col)
		end
	end

	palt(8, true)
	palt(0, false)
	pal(14, 132, 1)

	--draw sprites
	for sprite in all(sprites.enemies) do
		if sprite.state == "chase" then
			if lastppos[1] ~= flr(p.x / 8) or lastppos[2] ~= flr(p.y / 8) then
				local path=astar({sprite.x, sprite.y}, {p.x, p.y})
				if sprite.path then
					sprite.path = path
					sprite.step = 1
					printh("path "..ins(sprite.path).." "..time())
				end
				lastppos={flr(p.x / 8), flr(p.y / 8)}
			end

			sprite.goal = sprite.path[#sprite.path - sprite.step]
			if sprite.step < #sprite.path then
				mvspr2goal(sprite)
			end
			
			-- shoot gun if dist is less than 20 and player is in sight
			local dist = dist(sprite.x, sprite.y, p.x, p.y)

			if has_los(sprite.x, sprite.y, p.x, p.y) then
				-- reset timer
				sprite.timewhenlos = time()
				if dist < 20 and rnd(1) < 0.5 then
					-- shoot gun if dist is less
					spriteshoot(sprite)
				end
				if dist < 10 then
					sprite.state = "shoot"
				end
			end

			if sprite.timewhenlos + 5 <= time() then
				-- go back to patrol after 10 seconds
				sprite.state = "backtopatrol"
			end
		end

		if sprite.state == "backtopatrol" then
			sprite.path = astar({sprite.x, sprite.y}, {sprite.route[1][1], sprite.route[1][2]})
			sprite.step = 1
			sprite.goal = sprite.path[#sprite.path - sprite.step]
			if sprite.step < #sprite.path then
				mvspr2goal(sprite)
			else
				-- we can assume we are at the start of the route
				sprite.state = "patrol"
				sprite.step = 1
			end
		end

		if sprite.state == "shoot" then
			-- shoot player if dist is less than 6 and player is in sight
			local dist = dist(sprite.x, sprite.y, p.x, p.y)
			if dist < 10 and has_los(sprite.x, sprite.y, p.x, p.y) then
				if sprite.timewhenshoot + 1 <= time() then
					spriteshoot(sprite)
				end
			else
				sprite.state = "chase"
			end
		end

		if sprite.state == "patrol" then
			if sprite.step > #sprite.route then
				-- finished with route, restart
				sprite.step = 1
			end
			sprite.goal = sprite.route[sprite.step]
			mvspr2goal(sprite)
		end

		if has_los(sprite.x, sprite.y, p.x, p.y) and sprite.state ~= "shoot" then
			-- begin chase if player is in sight
			sprite.state = "chase"
			sprite.timewhenlos = time()
		end

		draw_sprite(sprite)

		map()

		for v in all(sprite.path) do
			local x = v[1]
			local y = v[2]
			rect(x - 4, y - 4, x + 4, y + 4, 11)
		end
		pset(sprite.x, sprite.y, 1)
		pset(p.x, p.y, 2)
	end

	--draw player weapon
	sspr(8*8,0,16,16,64-8*2,128-16*2,2*16,2*16)

	--draw minimap
	-- draw_minimap()

	--line(dir_ray.x,dir_ray.y,p.x,p.y,8)
	--pset(p.x,p.y,14)

	print("cpu: "..stat(1).." ".."mem: "..stat(0),7)
	print("fps: "..stat(7),7)
	print(peek(0x5f80))
end

function shoot_ray(x,y,a)
	local dx = cos(a)
	local dy = sin(a)

	local mapx = flr(x / 8)
	local mapy = flr(y / 8)

	local tilex = x / 8
	local tiley = y / 8

	local deltadistx = abs(1 / dx)
	local deltadisty = abs(1 / dy)

	local sidedistx, sidedisty, stepx, stepy, side

	if dx < 0 then
		stepx = -1
		sidedistx = (tilex - mapx) * deltadistx
	else
		stepx = 1
		sidedistx = (mapx + 1 - tilex) * deltadistx
	end
	if dy < 0 then
		stepy = -1
		sidedisty = (tiley - mapy) * deltadisty
	else
		stepy = 1
		sidedisty = (mapy + 1 - tiley) * deltadisty
	end

	local s = 1
	local hit = false

	while not hit do
		if sidedistx < sidedisty then
			sidedistx += deltadistx
			mapx += stepx
			side = 0
		else
			sidedisty += deltadisty
			mapy += stepy
			side = 1
		end

		s=mget(flr(mapx), flr(mapy))
		if s~=0 then
			hit = true
		end
	end

	local perpwalldist

	if side == 0 then
		perpwalldist = (sidedistx - deltadistx) * 8
		wallx = (y + perpwalldist * dy)
	else
		perpwalldist = (sidedisty - deltadisty) * 8
		wallx = (x + perpwalldist * dx)
	end

	-- if side == 0 and dx > 0 or side == 1 and dy < 0 then
	-- 	texx = 8 - texx - 1
	-- end

	return {dist=perpwalldist, tex=wallx, s=s}
end

function spriteshoot(sprite)
	local dist = dist(sprite.x, sprite.y, p.x, p.y)
	if rnd(dist)<weapons[p.weapon].accuracy * 6 then -- simulate accuracy
		-- deal damage to player
		p.hp -= 5
		sprite.timewhenshoot = time()
	end
end

function playershoot()
	local x = p.x
	local y = p.y
	local max_dist = weapons[p.weapon].range
	local dx = p.cosa
	local dy = p.sina

	for i = 1, max_dist do
		x += dx
		y += dy
		if mget(flr(x / 8), flr(y / 8)) ~= 0 then
			break
		end
		if is_enemy_hit(x, y) then
			printh("hit enemy")
			break
		end
	end
end

function is_enemy_hit(x, y)
	for enemy in all(sprites.enemies) do
		if abs(x - enemy.x) < 4 and abs(y - enemy.y) < 4 then
			enemy.hp -= 10
			printh("HIT: "..enemy.hp)
			return true
		end
	end
end

-- check if there is a line of sight between two points
function has_los(x1, y1, x2, y2)
	local dx = x2 - x1
	local dy = y2 - y1

	local dist = sqrt(dx * dx + dy * dy)

	local step_x = dx / dist
	local step_y = dy / dist

	local x = x1
	local y = y1

	for i=0, dist do
		x += step_x
		y += step_y
		if mget(flr(x / 8), flr(y / 8)) ~= 0 then
			return false
		end
	end

	return true
end

function draw_sprite(sprite)
	local posx = sprite.x - p.x
	local posy = sprite.y - p.y

	local tx = p.cosa * posy - p.sina * posx
	local ty = -p.sina * posy - p.cosa * posx

	local screenx = (128 / 2) * (1 + tx / ty)

	local sprh = abs(128 / ty) * sprite.hs
	local sprw = abs(128 / ty) * sprite.ws

	local draw_start_y=-sprh / 2 + 128/2
	local draw_start_x=-sprw / 2 + screenx

	if draw_start_x <= 127 and draw_start_x >= 0 then
		if lines[flr(draw_start_x) + 1] > abs(ty) and ty < 0 then
			sspr(sprite.s*8, 0, sprite.w, sprite.h, draw_start_x, draw_start_y, sprw, sprh)
		end
	end
end

function input_update()
	if btn(0,0) then
		p.a = (p.a - p.sens) % 1
	end
	if btn(1,0) then
		p.a = (p.a + p.sens) % 1 
	end
	p.cosa = cos(p.a)
	p.sina = sin(p.a)

	if btn(2, 1) then
		local nx = p.x + p.cosa * p.spd
		local ny=p.y + p.sina * p.spd
		if mget(flr(nx / 8), flr(ny / 8)) == 0 then
			p.x = nx
			p.y = ny
		end
	end
	if btn(3, 1) then
		local nx = p.x - p.cosa * p.spd
		local ny = p.y - p.sina * p.spd
		if mget(flr(nx / 8), flr(ny / 8)) == 0 then
			p.x = nx
			p.y = ny
		end
	end
	if btn(1, 1) then
		local strafe_ang = p.a + 0.25
		local nx = p.x + cos(strafe_ang) * p.spd
		local ny=p.y + sin(strafe_ang) * p.spd
		if mget(flr(nx / 8), flr(ny / 8)) == 0 then
			p.x = nx
			p.y = ny
		end
	end
	if btn(0, 1) then
		local strafe_ang = p.a - 0.25
		local nx = p.x + cos(strafe_ang) * p.spd
		local ny = p.y + sin(strafe_ang) * p.spd
		if mget(flr(nx / 8), flr(ny / 8)) == 0 then
			p.x = nx
			p.y = ny
		end
	end
	if btn(5) and p.timewhenshoot + weapons[p.weapon].fire_rate < time() then
		p.timewhenshoot = time()
		playershoot()
		printh("shoot"..time())
	end
end

-- slowly move sprite (e.g enemy) towards their goal (e.g player)
function mvspr2goal(sprite)
	local dx = sprite.goal[1] - sprite.x
	local dy = sprite.goal[2] - sprite.y
	local dist=sqrt(dx*dx+dy*dy)

	if dist <= sprite.spd then
		sprite.step += 1
		sprite.x = sprite.goal[1]
		sprite.y = sprite.goal[2]
	else
		sprite.x += dx / dist * sprite.spd
		sprite.y += dy / dist * sprite.spd
	end
end

--a* pathfinding algorithm
--starting point as {x,y}, end point as {x,y}
function astar(spnt,epnt)
	spnt = {flr(spnt[1] / 8), flr(spnt[2] / 8)}
	epnt = {flr(epnt[1] / 8), flr(epnt[2] / 8)}

	local open = {[pntkey(spnt)] = spnt}
	local camefrom={}

	local gscore = {[pntkey(spnt)] = 0}
	local fscore = {[pntkey(spnt)] = dist(spnt[1], spnt[2], epnt[1], epnt[2])}

	while next(open) do
		local currentkey, current=minf(open, fscore)
		if current[1] == epnt[1] and current[2] == epnt[2] then
			--found the path, now construct it and return it
			local path = {}
			while current do
				add(path, {current[1] * 8 + 4, current[2] * 8 + 4})
				current = camefrom[pntkey(current)]
			end
			return path
		end

		open[currentkey]=nil
		for n in all(neighbors(current)) do
			local nkey = pntkey(n)
			g = gscore[currentkey] + dist(current[1], current[2], n[1], n[2])
			if g < (gscore[nkey] or 32767) then
				gscore[nkey] = g
				fscore[nkey] = g + dist(n[1], n[2], epnt[1], epnt[2])
				camefrom[nkey] = current
				if not open[nkey] then
					open[nkey] = n
				end
			end
		end
	end

	printh("ahhhhh")
	return nil
end

function pntkey(p)
	return p[1]..','..p[2]
end

function minf(open, fscore)
	local minkey, minpnt = nil, nil
	local min = 32767
	for k, v in pairs(open) do
		local f = fscore[k] or 32767
		if f < min then
			min = f
			minkey = k
			minpnt = v
		end
	end
	return minkey, minpnt
end

function neighbors(node)
	local dirs = {{1, 0}, {1, 1}, {0, 1}, {-1, 1}, {-1, 0}, {-1, -1}, {0, -1}, {1, -1}}
	local n = {}
	for p in all(dirs) do
		local nx = node[1] + p[1]
		local ny = node[2] + p[2]
		if mget(nx, ny) == 0 then
			add(n, {nx, ny})
		end
	end
	return n
end

function dist(x1,y1,x2,y2)
	return sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2))
end

--function dist2col(dist)
	--the higher bits are the so-called "transition" colors
	--cols={0x77,0x76,0x66,0x6d,0xdd,0xd5,0x55,0x51,0x11,0x12,0x22,0x20,0x00}
	--dist=mid(1,dist,40)
	--local index=flr(#cols*(dist/40))+1
	--return cols[index] or cols[#cols]
--end

-- function draw_minimap()
-- 	clip(0,0,mm.w,mm.h)
-- 	palt(0,false)
--
-- 	local sx=flr(mid(-32,(mm.w/2)-p.x,0))
-- 	local sy=flr(mid(-56,(mm.h/2)-p.y,0))
-- 	map(0,0,sx,sy)
--
-- 	--draw player and direction line
-- 	local px=flr(p.x+sx)
-- 	local py=flr(p.y+sy)
--
-- 	local rx=flr(dir_ray.x+sx)
-- 	local ry=flr(dir_ray.y+sy)
--
-- 	line(px,py,rx,ry,8)
-- 	pset(px,py,8)
-- 	clip()
-- 	palt()
-- end
__gfx__
0000000077777777aaa99990aaa99990777777777777777788888999999888888888888008888888888066655666088800000000000000000000000000000000
0000000077777777a4444440a44444407dddddddddddddd788889e0440e988888888880660888888888066755667088800000000000000000000000000000000
007007007777777794444440944444407dddddddddddddd78889ee0440ee98888888805665088888888066755667088800000000000000000000000000000000
000770007777777700000000000000007dd5555555555dd788809e0440e908888888800000088888888067755766088800000000000000000000000000000000
0007700077777777990aaa99990aaa997dd5000000007dd7880ee999999ee0888888070670508888888067655766088800000000000000000000000000000000
0070070077777777440a4444440a44447dd5055555507dd7880ee044440ee0888888050550508888888076655676088800000000000000000000000000000000
000000007777777744094444440944447dd5056666707dd78806e044440e60888888050000508888888076655676088800000000000000000000000000000000
000000007777777700000000000000007dd5056666707dd788066774477660888888055555500888888066655666088800000000000000000000000000000000
0000000080089900aaa99990aaa999907dd5056666707dd7880eed6776dee0888888066666609088888067755666088800000000000000000000000000000000
0000000089989aa8a4444440a44444407dd5056666707dd7880ee044440ee0888880007777609088888066655666088800000000000000000000000000000000
000000000889888094444440944444407dd5057777707dd7880ee044440ee0888809900000099088888066655666088800000000000000000000000000000000
000000008a9aa8aa00000000000000007dd5000000007dd7880ee044440ee0888809999999999088888055011055088800000000000000000000000000000000
00000000088aaa90990aaa99990aaa997dd5777777777dd788066774477660888809faffffff9088888801111110888800000000000000000000000000000000
000000000088a888440a4444440a44447dddddddddddddd78880ed6776de08888809faffffff9088888804411440888800000000000000000000000000000000
00000000089a888044094444440944447dddddddddddddd78880ee0440ee08888809faaffff99088888880444408888800000000000000000000000000000000
00000000008a000000000000000000007777777777777777888800000000888888099faafff99088888880444408888800000000000000000000000000000000
__label__
a77977707a799990aaa97790aaa977707c7c777c77cccccc777c777c777ccccccccc777c7ccccccc777c777c77cc777ccccccccccccccccccccccccccccccccc
7444747074744740a4444740a44474707c7c7cccc7cccccc777c7ccc777cc7cccccccc7c7ccccccccc7c7c7cc7cc7c7ccccccccccccccccccccccccccccccccc
74447770747444409444474094447470777c777cc7cccccc7c7c77cc7c7cccccccccc77c777cccccc77c777cc7cc777ccccccccccccccccccccccccccccccccc
70007000707007000000070000007070cc7ccc7cc7cccccc7c7c7ccc7c7cc7cccccccc7c7c7ccccccc7c7c7cc7cc7c7ccccccccccccccccccccccccccccccccc
977a7a99977aaa99990a7779970a7779cc7c777c777ccccc7c7c777c7c7ccccccccc777c777cc7cc777c777c777c777ccccccccccccccccccccccccccccccccc
440a4444440a4444440a4444440a4444cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
77797774477944444409774477794444cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
70007070700007000000070070000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
77a97770777000000000070077777777cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
7444744000700700000007007d7dddddcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
744474407770070000707770777dddddcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
0000000000077000000770007dd55555cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
990aaa9900077000000770007dd50000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
440a444400700700007007007dd50555cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
4409444408000000000000007dd50566cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
0000000000800000000000007dd50566cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaa99990008000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
a4444440000800000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
94444440007087000070070000700700cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
00000000000778000007700000077000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
990aaa99000778000007700000077000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
440a4444007007800070070000700700cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44094444000000080000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
00000000000000080000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaa99990000000008000000077777777cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
a444444000000000080000007dddddddcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
9444444000700700008007007dddddddcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
0000000000077000008770007dd55555cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
990aaa9900077000000870007dd50000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
440a444400700700007087007dd50555cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
4409444400000000000080007dd50566cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
0000000000000000000008007dd50566cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
000044444aaacccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaaa44444aaaaacccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaaa44444aaaaacccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaaa00000999aacccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
aaaa00000999449ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44449999999944999ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44449999900044499ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44449999900044444ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44444444499900444acccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
44444444499900444a9ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
4444444449990004449acccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
0000444444440000044acccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc777777777777
00004444444400a0044a9ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc7777cccccccccccccccccccccccccccc777777777777
00004444444400a9904999ccccccccccccccccccccccccccccccccccccccccccccccccccc777777777777777777777cccccccccccccccccccccc77dddddddddd
99990000044400499009499cccccccccccccccccccccccccccccccccccccccccccccc777777777777777dd777777777777cccccccccccccccccc77dddddddddd
99990000000000444000449cccccccccccccccc777777777777777777cccccccccccc7777ddddddddddddd77dddddd777777777ccccccccccccc77dddddddddd
999999999000004440a9444acccccccccccccc7777777777777777777cccccccccccc77ddddddddddddddd77dddddddd77777777cccccccccccc77dddd555555
99999999900000444049004a9ccccccccccccc7dddd7ddddddddddddd77777777cccc77dd55555555555dd77555555dd77ddddd7a099aa099aa077dddd770000
444499999aaa00044044aa044a99aa9aaa90a9ddddd7ddddddddddddd7ddddddda9a977d500000005555dd775500005577ddddd740444a04444077dddd770000
444444444aaaaa0000444a944444a44aa44044d55dd7d5555555555dd7ddddddd444477d700000000055dd775500000777d5555740444904444077dddd770055
444444444aaaaa999044444004449449944044d00dd7d5000000007dd755555dd444477d705555550055dd775555550777d0000700000000000077dddd770077
444444444aaa449990004440a0000000000000d55dd7d5555555007dd700007dd000077d707766660055dd775555665777d5550799aa099aa09977dddd770077
444444444aaa44444a9a004049a990a990a99ad65dd7d5566666007dd705557dd9a9a77d707766660055dd775555667777d5660744440444404477dddd770077
4444444449994444449a99004444404440444ad65dd7d5566666007dd705667dd444477d707766660055dd775555667777d5660744440444404477dddd770077
0000444449994444444a999004444044404449d65dd7d5566666007dd705667dd444477d707766660055dd775555667777d5660700000000000077dddd770077
00000000000000444449444a90000000000000d65dd7d5566666007dd705667dd000077d707766660055dd775555667777d56607a099aa099aa077dddd770077
0000000000000000044944444a99aa9aaa90a9d75dd7d5566666007dd705667dd444477d707777770055dd775555777777d5670740444a04444077dddd770077
aaaa999999990000000040044444a44aa44044d05dd7d5577777007dd705777dd444477d700000000055dd775500007777d5770740444904444077dddd770000
aaaa9999999900a990a90a90a0000000000000d70dd7d5000000007dd700007dd000077d777777770055dd775577770777d0007700000000000077dddd777777
aaaa9999999900a990a9aa4049a990a990a99add7dd7d5777777777dd777777dd9a9a77d7ddd77777755dd775577dd7777d7777799aa099aa09977dddd777777
aaaa444444440044404444404444404440444addddd7ddddddddddddd7ddddddd444477ddddddddddddddd77dddddddd77ddddd744440444404477dddddddddd
44444444444400444044444004444044404449ddddd7ddddddddddddd7ddddddd444477ddddddddddddddd77dddddddd77ddddd744440444404477dddddddddd
44444444444400444040400060000000000000777777777777777777777777777000077dd7777777dddd7777dd7777d777d7777700000000000077dddddddddd
44444444444400400000066666666666666666666666666666666666666666666666666776666666777766667766667666766660666666666666777777777777
44444444444400000006066666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
44444444400000066666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
44440000000066066666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
00000000066666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
00006666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
00006666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
00006666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666

__map__
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003030003030000
0200000000000000000000000000000200000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000303000303
0200000404040400000404040400000200000404040400000404040400000002000000040400000000000404000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000000000000000400000002000004040400000400000404040000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000000000000000400000002000000040400000000000404000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000404040400000400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000400000400000400000400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000400000400000400000400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000400000400000400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000000000000000400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000400000000000000000400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000404040400000404040400000200000404040404040404040400000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000002020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
